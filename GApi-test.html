<!DOCTYPE html>
<html>

<head>
    <title>Drive API Quickstart</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="View/test.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" type="image/png" href="Resources/View/favicon.ico" />

    <script src="Libs/jquery-3.4.1.min.js"></script>
    <script src="Libs/iframe-resizer-master/js/iframeResizer.min.js" type="text/javascript"></script>
    <script src="Tools.js" type="text/javascript"></script>
    <script src="Gapi.js" type="text/javascript"></script>
    <script src="Gauth-new.js" type="text/javascript"></script>
    <script src="View/FormTools.js" type="text/javascript"></script>
    <script src="View/FormTools_mcss1.0.js" type="text/javascript"></script>
    <script src="View/Popup.js" type="text/javascript"></script>
    <script src="mainWindowView.js" type="text/javascript"></script>
    <script src="View/SearchNavigationBar.js" type="text/javascript"></script>
    <script src="View/NavigationBar.js" type="text/javascript"></script>
    <script src="PsNavigationBar.js" type="text/javascript"></script>
    <script src="Setup.js" type="text/javascript"></script>
    <script src="Projects/ProjectsSetup.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
    <script src="Repository.js" type="text/javascript"></script>
    <script src="SimpleRepository.js" type="text/javascript"></script>
    <script src="MainController.js" type="text/javascript"></script>
    <script src="Projects/ProjectsDetailsController.js" type="text/javascript"></script>

</head>

<body>
    <p>Drive API Quickstart</p>
    <div id='buttonDiv'></div>
    <!--Add buttons to initiate auth sequence and sign out-->
    <button id="authorize_button" onclick="gapiFunctionHandler()">Authorize</button>
    <button id="signout_button" onclick="GApi.signoutHandler()">Sign Out</button>

    <pre id="content" style="white-space: pre-wrap;"></pre>

    <script type="text/javascript">
        let gapiInited = false;
        let gisInited = 1;

        document.getElementById('authorize_button').style.visibility = 'hidden';
        document.getElementById('signout_button').style.visibility = 'hidden';

        /**
         * Enables user interaction after all libraries are loaded.
         */
        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('authorize_button').style.visibility = 'visible';
            }
        }
        document.getElementById('authorize_button').style.visibility = 'visible';
        function gapiFunctionHandler() {
            if (GApi.isAccesTokenValid()) {
                console.log('using stored valid token');
                // Skip display of account chooser and consent dialog for an existing session.
                //MainSetup.GApi.tokenClient.requestAccessToken();
                listFiles()
            }
        }

        /**
         *  Sign out the user upon button click.
         */
        function handleSignoutClick() {
            GApi.signoutHandler();
            document.getElementById('content').innerText = '';
            document.getElementById('authorize_button').innerText = 'Authorize';
            document.getElementById('signout_button').style.visibility = 'hidden';
        }

        /**
         * Print metadata for first 10 files.
         */
        async function listFiles() {
            let response;
            try {
                response = await gapi.client.drive.files.list({
                    'pageSize': 10,
                    'fields': 'files(id, name)',
                });
            } catch (err) {
                document.getElementById('content').innerText = err.message;
                return;
            }
            const files = response.result.files;
            if (!files || files.length == 0) {
                document.getElementById('content').innerText = 'No files found.';
                return;
            }
            // Flatten to string to display
            const output = files.reduce(
                (str, file) => `${str}${file.name} (${file.id}\n`,
                'Files:\n');
            document.getElementById('content').innerText = output;
        }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="GApi.gapiLoadedHandler()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="GApi.gapiLoaded()"></script>
</body>

</html>